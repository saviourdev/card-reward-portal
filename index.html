<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin Panel</title>
<style>
:root { --bg:#0b0c10; --card:#111318; --muted:#a9b0b8; --text:#e9eef3; --accent:#22c55e; --danger:#ef4444; --border:#23262d; }
body{margin:0;background:linear-gradient(160deg,#0b0c10,#0f1115 40%,#0b0c10);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
.wrap{max-width:960px;margin:24px auto;padding:20px}
h1{margin:0 0 20px;text-align:center}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:16px}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:10px;border-bottom:1px solid var(--border);text-align:left;font-size:14px}
.btn{padding:6px 12px;border-radius:8px;border:none;cursor:pointer}
.btn-approve{background:var(--accent);color:#052e13}
.badge{padding:4px 8px;border-radius:999px;font-size:12px;background:#0b0d12;color:var(--muted);border:1px solid var(--border)}
.center{text-align:center}
#loginCard input{width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:#0b0d12;color:var(--text)}
#loginCard button{margin-top:10px;width:100%;background:var(--accent);color:#052e13;font-weight:bold;padding:10px;border:none;border-radius:8px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Admin Panel â€” Approve Users</h1>

  <!-- Password login -->
  <div class="card" id="loginCard">
    <h2 class="center">Enter Admin Password</h2>
    <input id="adminPassword" type="password" placeholder="Enter password">
    <button id="loginBtn">Login</button>
    <div id="loginError" class="center" style="color:var(--danger);margin-top:8px;display:none;">Invalid password!</div>
  </div>

  <!-- Table -->
  <div class="card" id="tableCard" style="display:none">
    <table class="table" id="usersTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Phone</th>
          <th>Balance</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="usersBody">
        <tr><td colspan="5" class="center" style="color:var(--muted)">Loading users...</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, onSnapshot, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

// âœ… Use the SAME Firebase config as index.html
const firebaseConfig = {
  apiKey: "AIzaSyC24O6ZV8kHo9rqTr88ERBsRLgbK_Dez8k",
  authDomain: "admin-panel-database-6e378.firebaseapp.com",
  projectId: "admin-panel-database-6e378",
  storageBucket: "admin-panel-database-6e378.firebasestorage.app",
  messagingSenderId: "296556886458",
  appId: "1:296556886458:web:dfd1382b99a6b774ec0583"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ðŸ”‘ Simple admin password (change this!)
const ADMIN_PASSWORD = "mySecret123";

document.getElementById("loginBtn").addEventListener("click", () => {
  const pass = document.getElementById("adminPassword").value;
  if(pass === ADMIN_PASSWORD){
    document.getElementById("loginCard").style.display = "none";
    document.getElementById("tableCard").style.display = "block";
    loadUsers();
  } else {
    document.getElementById("loginError").style.display = "block";
  }
});

// âœ… Load and watch users collection in realtime
function loadUsers(){
  const tbody = document.getElementById("usersBody");
  onSnapshot(collection(db, "users"), (snapshot) => {
    tbody.innerHTML = "";
    if(snapshot.empty){
      tbody.innerHTML = `<tr><td colspan="5" class="center" style="color:var(--muted)">No users yet</td></tr>`;
      return;
    }
    snapshot.forEach(docSnap => {
      const user = docSnap.data();
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${user.name}</td>
        <td>${user.phone}</td>
        <td>${(user.balance || 0).toFixed(2)} PLN</td>
        <td>${user.pendingApproval ? '<span class="badge" style="background:#422006;color:#facc15">Pending</span>' : '<span class="badge" style="background:#052e13;color:#c9f6de">Approved</span>'}</td>
        <td>
          ${user.pendingApproval ? `<button class="btn btn-approve" data-id="${docSnap.id}" data-balance="${user.balance || 0}">Approve</button>` : ""}
        </td>
      `;
      tbody.appendChild(tr);
    });
    attachApproveButtons();
  });
}

// âœ… Approve button function
function attachApproveButtons(){
  document.querySelectorAll(".btn-approve").forEach(btn=>{
    btn.addEventListener("click", async ()=>{
      const id = btn.dataset.id;
      const currentBalance = Number(btn.dataset.balance);
      const profit = prompt("Enter amount to credit:", "100");
      if(!profit || isNaN(profit)) return alert("Invalid amount");
      await updateDoc(doc(db, "users", id), {
        balance: currentBalance + Number(profit),
        pendingApproval: false
      });
      alert("âœ… User approved!");
    });
  });
}
</script>
</body>
</html>